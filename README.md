# はじめに
`csv_converter.rb` はCSVの行の3番目のカラムでグルーピングされる行グループについて、そのグループの先頭行のみ19番目のカラム、20番目のカラム、21番目のカラムの値が設定されているところ、同じグループのその他の行についても、これらの値を補完する処理を行うスクリプトです。

## csv変換の例
#### 変換前CSV
```
"1","0","1","20181101","","","1/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-25","","2","","1","","","","139","150","11","","","","","XXX","","","","","","","","","","","","","1","0","xxxx","1","","","","","","","150","139","11","","","","23","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","3625","3906","281","","","","","XXX","","","","","","","","","","","","","2","0","xxxx","1","","","","","","","34","32","2","","","","24","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","","","","","","","","XXX","","","","","","","","","","","","","3","0","xxxx","1","","","","","","","341","316","25","","","","25","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","","","","","","","","XXX","","","","","","","","","","","","","4","0","xxxx","1","","","","","","","3431","3177","254","","","","25","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","","","","","","","","XXX","","","","","","","","","","","","","5","0","xxxx","1","","","","","","","100","100","0","","","","25","","","","","","","","","","","",""
```

#### 変換後CSV
```
"1","0","1","20181101","","","1/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-25","","2","","1","","","","139","150","11","","","","","XXX","","","","","","","","","","","","","1","0","xxxx","1","","","","","","","150","139","11","","","","23","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","3625","3906","281","","","","","XXX","","","","","","","","","","","","","2","0","xxxx","1","","","","","","","34","32","2","","","","24","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","3625","3906","281","","","","","XXX","","","","","","","","","","","","","3","0","xxxx","1","","","","","","","341","316","25","","","","25","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","3625","3906","281","","","","","XXX","","","","","","","","","","","","","4","0","xxxx","1","","","","","","","3431","3177","254","","","","25","","","","","","","","","","","",""
"1","0","2","20181101","","","2/2018年10月xxxx","2","XXXXXXXXXX","1","2018-11-27","","2","","1","","","","3625","3906","281","","","","","XXX","","","","","","","","","","","","","5","0","xxxx","1","","","","","","","100","100","0","","","","25","","","","","","","","","","","",""

```

# 設定
設定は `config.yml` にyaml形式で設定してください。
`config.yml` については、`csv_convertor.rb` スクリプトを実行するワーキングディレクトリ（開始ディレクトリ）に配置してください。通常は `csv_convertor.rb` と同じディレクトリに配置して、`csv_convertor.rb` があるディレクトリをワーキングディレクトリとしてスクリプトを実行すると良いでしょう。
### 各設定値について
- source_dir 
	- 処理対象となるcsvを配置するディレクトリです。このディレクトリに`.csv`の拡張子のファイルが配置されていたら、処理が行われます。処理が完了したら処理後のファイルは後述の`dist_dir`に保存され、元のファイルは、`backup_dir`に移動されます。
- dist_dir
	- 処理済みのcsvファイルが配置されるディレクトリです。sourceファイル名に`converted_`が先頭に付加された形で保存されます
- backup_dir
	- 処理が完了したら、sourceファイルの内容はそのままに、sourceファイル名に`backuped_`が先頭に付加された形で保存されます。

# 前提条件等
### スクリプトの実行環境について
- Ruby2.5.3が動作する環境であること（その他のバージョンでの動作は保証されません）

### 処理対象のCSVについての前提
- ヘッダー行はなし
- 文字コードがsjisであること
- 区切り文字は`,`であること
- 全てのカラムがダブルクオートで括られていること

# `for_windows.bat` ファイルについて
`for_windows.bat` ファイルはwindowsのタスクスケジューラー等から、ruby scriptを呼び出す用途のために用意したwindowsバッチファイルです。`csv_convertor.rb`と同一ディレクトリに配置して実行してください。
